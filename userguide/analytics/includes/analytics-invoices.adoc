The tables *analytics_invoices*, *analytics_invoice_adjustments*, *analytics_invoice_item_adjustments*, *analytics_invoice_credits* and *analytics_invoice_items* maintain information about invoices posted by account.

Definitions:

* *invoice_balance*: invoice_amount_charged + invoice_amount_credited + invoice_amount_adjusted_for_account_credit - (invoice_amount_paid + invoice_amount_refunded)
* *invoice_amount_charged*: sum of all *analytics_invoice_items*, *analytics_invoice_adjustments* and *analytics_invoice_item_adjustments* items for that invoice
* *invoice_amount_credited*: sum of all *analytics_invoice_credits* items for that invoice (positive if granted, negative if used)
* *invoice_amount_paid*: sum of all *analytics_payments* items for that invoice
* *invoice_amount_refunded*: sum of all *analytics_chargebacks* and *analytics_refunds* items for that invoice
* *invoice_original_amount_charged*: sum of all *analytics_invoice_items* items for that invoice at the time of invoice creation

Note that *invoice_amount_adjusted_for_account_credit* is an internal adjustment that applies for account level credits only (CREDIT_ADJ items on their own invoices) and is not represented in Analytics. The full details of the computations can be found in https://github.com/killbill/killbill/blob/master/invoice/src/main/java/org/killbill/billing/invoice/calculator/InvoiceCalculatorUtils.java[InvoiceCalculatorUtils.java].

A few remarks:

* EXTERNAL_CHARGE, FIXED and RECURRING items are treated as regular line items (stored in *analytics_invoice_items*)
* ITEM_ADJ items are treated as invoice item adjustments (stored in *analytics_invoice_item_adjustments*)
* CBA_ADJ items (gained or consumed) are treated as account credits (stored in *analytics_invoice_credits*)
* CREDIT_ADJ items that are not on their own invoice are treated as invoice adjustments (stored in *analytics_invoice_adjustments*). Note that these should not be mixed with account level credits: when an administrator creates an account credit (different from CBA credits generated by the system), a negative CREDIT_ADJ item is added to a new invoice. This triggers a positive CBA_ADJ item (to bring the balance back to zero), which effectively becomes the account credit (and eventually stored in *analytics_invoice_credits*). In this case, the CREDIT_ADJ item will not be stored directly in the analytics tables
* Kill Bill repair items (REPAIR_ADJ) are not stored directly in any of these tables, but are combined with the new reparee item as invoice item adjustments (in *analytics_invoice_item_adjustments*). For example, if a recurring item of $20 was repaired into a $5 recurring item, *analytics_invoice_items* would contain the original $20 line item and *analytics_invoice_item_adjustments* would contain a $-15 adjustment item
* Any invoice item has a revenue recognizable attribute which is used to tell if the item is recognizable from a finance perspective (tied to cash). This is used for credits only today and we assume that any administrator generated credit (CREDIT_ADJ and CBA_ADJ on their own invoice) is not recognizable. All other credit items, including system generated ones, are.
